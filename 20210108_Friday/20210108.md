# Leetcode: 1504. Count Submatrices With All Ones.

- https://gist.github.com/lbvf50mobile/ed0d8bb7035a060949a64bebf0b92ab5

```Ruby
# Leetcode: 1504. Count Submatrices With All Ones.
# https://leetcode.com/problems/count-submatrices-with-all-ones/
# @param {Integer[][]} mat
# @return {Integer}
def num_submat(mat)
    @m = mat
    @r = row_prefix()
    @c = coll_prefix()
    @sum = 0
    
    (0...@m.size).each do |i|
        (0...@m[0].size).each do |j|
            count(i,j,@m[0].size-i)
        end
    end
    
    @sum
end

def count(i,j,steps)
    (0...steps).each do |k|
        prev = 0
        prev =  @r[i][j-1] if i != 0
        curr = @r[i][j+k]
        break if 0 == curr
        @sum += curr - prev
    end
end

def row_previx()
    x = Array.new(@m.size).map{ Array.new(@m[0].size,0)}
    (0...@m.size).each do |i|
        (0...@m[0].size).each do |j|
            prev = 0
            prev = x[i][j-1] if j != 0
            x[i][j] = (prev + @m[i][j])*@m[i][j]
        end
    end
    x
end
def coll_prefix()
    x = Array.new(@m.size).map{ Array.new(@m[0].size,0)}
    (0...@m[0].size).each do |j|
        (0...@m.size).each do |i|
            prev = 0
            prev = x[i-1][j] if i != 0
            x[i][j] = (prev + @m[i][j])*@m[i][j]
        end
    end
    x
end
```