# Leetcode: 638. Shopping Offers.

- https://gist.github.com/lbvf50mobile/b503f9cbb12306c52aac33404638f569

Now I going to improve my yesterday solution.

- First check then do.
- And save used special offers.

After first optimization still TLE. Next optimization would be about coef.
Ruby:
```Ruby
# Leetcode: 638. Shopping Offers.
# https://leetcode.com/problems/shopping-offers/
# @param {Integer[]} price
# @param {Integer[][]} special
# @param {Integer[]} needs
# @return {Integer}
# TLE: https://leetcode.com/submissions/detail/457633507/testcase/
def shopping_offers(price, special, needs)
    @dp = Array.new(7) # a
        .map{ Array.new(7) # b
        .map {Array.new(7) # c
        .map {Array.new(7) # d
        .map {Array.new(7) # e
        .map {Array.new(7)}}}}} # f 
    extend_amount = 6 - price.size
    @pr = price + [0]*extend_amount
    nd = needs + [0]*extend_amount
    @sp = special.map{|x| [x.last,x[0...x.size-1] + [0]*extend_amount]}
    rec(*nd,0)
end
def rec(a,b,c,d,e,f,used)
    return @dp[a][b][c][d][e][f] if @dp[a][b][c][d][e][f]
    nd = [a,b,c,d,e,f]
    if nd.all?{|x| 0 == x}
        @dp[a][b][c][d][e][f] = 0
        return @dp[a][b][c][d][e][f]
    end
    ans = []
    # Do not use speciall offers.
     (0...@pr.size).each do |i|
        if nd[i] >= 1 # Fist improvement by only when need to buy.
            tmp = nd.clone
            tmp[i] -= 1
            rest = rec(*tmp,used)
            price = @pr[i]
            ans.push(price + rest)
        end
    end
    # Iterate over all special offers.
    @sp.each_with_index do |el,i|
        if 0 == used & (2**i)
            money = el.first
            sp = el.last
            mul = coef(sp,nd)
            if mul > 0
                price = money * mul
                rest = rec(*nd.zip(sp.map{|x| x*mul}).map{|(a,b)| a - b},used | (2**i))
                ans.push(price + rest)
            end
        end
    end
    @dp[a][b][c][d][e][f] = ans.min
    return @dp[a][b][c][d][e][f]
end

def coef(sp,nd)
    (1..6).reverse_each do |i|
       return i if nd.zip(sp.map{|x| x*i}).map{|(a,b)| a - b}.all?{|x| x >= 0}
    end
    0
end


```