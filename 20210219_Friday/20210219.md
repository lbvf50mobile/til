# Leetcode: 638. Shopping Offers.

- https://gist.github.com/lbvf50mobile/b503f9cbb12306c52aac33404638f569

Today I want to crate a program that address sub problem as required number and set of super offers that could not be used.


This idea fails on base test.
```Ruby
# Leetcode: 638. Shopping Offers.
# https://leetcode.com/problems/shopping-offers/
# @param {Integer[]} price
# @param {Integer[][]} special
# @param {Integer[]} needs
# @return {Integer}
# Fails on base test.
def shopping_offers(price, special, needs)
    @dp = {}
    extend_amount = 6 - price.size
    @pr = price + [0]*extend_amount
    nd = needs + [0]*extend_amount
    @sp = special.map{|x| [x.last,x[0...x.size-1] + [0]*extend_amount]}
    rec(nd.join,0)
end
def rec(str,used)
    return @dp[used][str] if @dp[used] && @dp[used][str]
    @dp[used] ||= {}
    save = used
    nd = str.chars.map(&:to_i)
    if nd.all?{|x| 0 == x}
        @dp[used][str] = 0
        return @dp[used][str]
    end
    ans = []
    # Do not use speciall offers.
     (0...@pr.size).each do |i|
        if nd[i] >= 1 # Fist improvement by only when need to buy.
            tmp = nd.clone
            tmp[i] -= 1
            rest = rec(tmp.join,used)
            price = @pr[i]
            ans.push(price + rest)
        end
    end
    # remove unusable
    @sp.each_with_index do |el,i|
        if (0 == (used & (2**i)) )&& unusable(el.last,nd)
            used = used | (2**i)
        end
    end
    # Iterate over all special offers.
    @sp.each_with_index do |el,i|
        if 0 == used & (2**i)
            money = el.first
            sp = el.last
            mul = coef(sp,nd)
            if mul > 0
                price = money * mul
                rest = rec(nd.join, used | (2**i))
                ans.push(price + rest)
            end
        end
    end
    @dp[save][str] = ans.min
    return @dp[save][str]
end

def unusable(sp,nd)
    (0...6).each do |i|
        return true if sp[i] > nd[i]
    end
    false
end
def coef(sp,nd)
    (1..6).reverse_each do |i|
       return i if nd.zip(sp.map{|x| x*i}).map{|(a,b)| a - b}.all?{|x| x >= 0}
    end
    0
end
```