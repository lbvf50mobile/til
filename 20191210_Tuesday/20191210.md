# Rails: rails command belongs to railties gem.

### How question appeard:

Datsan asked my why do an error happens during migrations on [Frab](https://github.com/frab/frab) application.
I started to look at the code of [Rails](https://github.com/rails/rails) to understand how do the
`rails db:drop` and `rails db:setup` works.

### Story itself.

When I started to work with the [Rails](https://github.com/rails/rails) repo I find a plenty of different direcotries and huge amount
of files.

What did I think:

When I type `rails db:stup` at a `bash` command line. I'm starting programm called `rails` and pass `db:setup` argument to this program.
And there must be a code in Ruby that make this program.

Than I asked my friend Maxim about what happens when I print `rails` in CLI, he told me that this is an alias of `rake`. And in prior versions of 
Rails we have to type `rake and command names`.

Now I have a qustions: where do in "Rails" code an  alias for `rake` existed to be treated like rails.

### [Explanation](https://stackoverflow.com/a/59268449/8574922)

How to the `rails` works from the Linux shell point of view? 


**"rails" command is a part of the Railties gem**

 - Start `rails` file that stored at the `ruby_instalation_dir/bin`. This file is generated by [RubyGems](https://github.com/rails/rails/blob/master/railties/railties.gemspec#L23-L24) from the **Railties** gemsec file. (https://stackoverflow.com/a/59269405/8574922)
 - `rails` file is a Ruby file that calls [railaties/rails](https://github.com/rails/rails/blob/master/railties/exe/rails) file
 - and the `railaties/rails` file requires [rails/cli.rb](https://github.com/rails/rails/blob/master/railties/lib/rails/cli.rb)

Yes `rails` is an executive file that stores in `ruby_destination/bin` folder. This is a Ruby file generated by RubyGems.

And this files calls for another Gem called [Railties](https://github.com/rails/rails/tree/master/railties) that can be installed in the same `bin` folder, or in the `Gems` folder, that can be found by a `bundle show --paths` command. Here it is [this executable](https://github.com/rails/rails/blob/master/railties/exe/rails) file that is called from `rails`.

So the journey begins from the `require "rails/cli"` of the [Railties](https://github.com/rails/rails/tree/master/railties). 

So the journey begins from the `require "rails/cli"` of the [Railties](https://github.com/rails/rails/tree/master/railties).

### [How do the rails file generated](https://stackoverflow.com/questions/59269130/where-is-the-pattern-of-code-that-creates-ruby-bin-rails-file).

Today I worked with the way a system executes `rails` command. And discover this chain

`ruby_instalation_dir/bin/rails` -> [ruby/gems/reilaties/exe/rails](https://github.com/rails/rails/blob/master/railties/exe/rails) -> [ruby/gems/reilaties/lib/rails/cli.rb](https://github.com/rails/rails/blob/master/railties/lib/rails/cli.rb)

Last two elements of this chain I able to find in the GitHub.

Now I'm seeking what is the instructions that tell `RubyGem` how to generate `rails` file. I did not find any match of `railaties` in the [rails.gemspec](https://github.com/rails/rails/blob/master/rails.gemspec) file. But some how `RubyGem` knows that need to call `railaties` gem. Where does this information stored?


**The rails command is part of the railties gem, not part of the rails gem. Therefore, you need to look in the railties gemspec**:

- https://stackoverflow.com/a/59269405/8574922
- https://github.com/rails/rails/blob/master/railties/railties.gemspec#L23-L24

```Ruby
s.bindir      = "exe"
s.executables = ["rails"]
```

