# Leetcode: 1277. Count Square Submatrices with All Ones. Top-down DP.

**Ruby: Top-down recursion.**

Each square counted by a bottom right corner. In DP array stored number of squares that has bottom right corner at a cell. Starting from position of potential biggest square (if a matrix is square and contains only ones) and calculate it size by recursive calls.  Size of an square calculated by squares which bottom right corners surround it's bottom right corner from gore directions: top, left, and top-left diagonal.

While solving this task in Top-Down approach I found:

1. In Top-Down approach each cell must be visited, if in Bottom-down iteration it's possible to skip zeros. Because to fill all DP array, and also keep track of visited cells, so DP array stores nil's to mark un visited spots, and 0 if a spot has zero.
2. In To-Down approach each recursion call must return value of a cell it called for. This was my second mistake during implementation.



Ruby code:
```Ruby
# Leetcode: 1277. Count Square Submatrices with All Ones.
# https://leetcode.com/problems/count-square-submatrices-with-all-ones/
# Runtime: 172 ms, faster than 25.00% of Ruby online submissions for Count Square Submatrices with All Ones.
# Memory Usage: 228.1 MB, less than 12.50% of Ruby online submissions for Count Square Submatrices with All Ones.
# @param {Integer[][]} matrix
# @return {Integer}
def count_squares(matrix)
    @mtx = matrix.map{|el| [0] + el}
    @mtx.unshift(Array.new(@mtx[0].size,0))
    @dp = Array.new(@mtx.size).map{ Array.new(@mtx[0].size)}
    (0...@mtx[0].size).each{|j| @dp[0][j] = 0}
    (0...@mtx.size).each{|i| @dp[i][0] = 0}
    @count = 0
    recursion(@mtx.size-1, @mtx[0].size-1)
    @count
end
def recursion(i,j)
    return @dp[i][j] if @dp[i][j]
    a = recursion(i-1,j-1)
    b = recursion(i-1,j)
    c = recursion(i,j-1)
    if @mtx[i][j].zero?
        @dp[i][j] = 0
        return 0 # Recursion must return a value of the cell!
    end
    ans = [a,b,c].min + 1
    @count += ans
    @dp[i][j] = ans
    ans # Recursion must return a value of the cell!
end
```